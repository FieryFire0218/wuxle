<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wuxle - Guess the Novel</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <h1>ðŸ“š Wuxle</h1>
  <p>Guess the WuxiaWorld novel of the day!</p>

  <input type="text" id="guessInput" placeholder="Enter novel title..." list="novelOptions">
  <datalist id="novelOptions">
    {% for title in novels %}
      <option value="{{ title }}">
    {% endfor %}
  </datalist>
  <button onclick="submitGuess()">Guess</button>

  <div id="results"></div>

  <script>
    async function submitGuess() {
      const title = document.getElementById("guessInput").value;
      const res = await fetch("/guess", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({title})
      });
      const data = await res.json();

      let resultsDiv = document.getElementById("results");
      if (data.error) {
        resultsDiv.innerHTML += `<p style="color:red">${data.error}</p>`;
        return;
      }

      if (data.title === "ðŸŽ‰ Correct!") {
        resultsDiv.innerHTML += `<p>ðŸŽ‰ You guessed it! The novel was <b>${title}</b>.</p>`;
        } else {
        const genres = data.genres;
        resultsDiv.innerHTML += `<p>Guess: <b>${title}</b><br>
            Author: ${data.author} | Translator: ${data.translator}<br>
            Genres: ${genres.summary} (Matched: ${genres.matched.join(", ")})<br>
            Rating: ${data.rating} | Chapters: ${data.chapters}</p>`;
        }
    }
  </script>
  
  <button onclick="revealAnswer()">Give Up</button>

  <script>
    async function revealAnswer() {
        const res = await fetch("/answer");
        const ans = await res.json();
        document.getElementById("results").innerHTML += `
        <p>ðŸ’¡ The novel was <b>${ans.title}</b> by ${ans.author}<br>
        Translator: ${ans.translator}<br>
        Genres: ${ans.genres.join(", ")}<br>
        Rating: ${ans.rating} | Chapters: ${ans.chapters}</p>`;
    }
  </script>

</body>
</html>
